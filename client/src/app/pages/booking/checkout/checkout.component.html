<section class="mx-auto px-4 py-8 max-w-[1400px]">
  <h1>Boka boende</h1>

  <div class="flex flex-row gap-16">
    <section>
      <section>
        <h2>Välj hur du vill betala</h2>
        <app-select-box
          label="Alternativ"
          placeholder="Betala hela summan direkt"
          [options]="['Betala hela summan direkt', 'Betala senare']"
          [(ngModel)]="paymentTime"
          [uniqueId]="'payment-time-select'"
          (blur)="validatePaymentTime()"
          (change)="onPaymentTimeChange()"
          [ngClass]="{
            'is-invalid': !isPaymentTimeValid && hasInteractedWithPaymentTime
          }"
        >
        </app-select-box>
        <div
          *ngIf="!isPaymentTimeValid && hasInteractedWithPaymentTime"
          class="text-red-500 text-sm"
        >
          Välj ett betalningsalternativ.
        </div>
      </section>
      <section>
        <h2>Betala med</h2>
        <div class="flex flex-col gap-4">
          <app-select-box
            label="Välj betalningsmetod"
            placeholder="Kredit- eller betalkort"
            [options]="['Kredit- eller betalkort', 'PayPal', 'Google Pay']"
            [(ngModel)]="paymentMethod"
            [uniqueId]="'payment-method-select'"
            (blur)="validatePaymentMethod()"
            (change)="onPaymentMethodChange()"
            [ngClass]="{
              'is-invalid':
                !isPaymentMethodValid && hasInteractedWithPaymentMethod
            }"
          >
          </app-select-box>
          <div
            *ngIf="!isPaymentMethodValid && hasInteractedWithPaymentMethod"
            class="text-red-500 text-sm"
          >
            Välj en betalningsmetod.
          </div>
          <app-text-input
            [inputType]="'text'"
            [label]="'Kortnummer'"
            [(ngModel)]="cardNumber"
            (input)="onCardNumberInput($event)"
            (blur)="validateCardNumber()"
            [ngClass]="{
              'is-invalid': !isCardNumberValid && hasInteractedWithCardNumber
            }"
          ></app-text-input>
          <div
            *ngIf="!isCardNumberValid && hasInteractedWithCardNumber"
            class="text-red-500 text-sm"
          >
            Kortnumret får endast innehålla siffror och måste vara 16 siffror.
          </div>

          <div class="flex flex-row gap-4">
            <div class="flex flex-col w-1/2">
              <app-text-input
                [inputType]="'text'"
                [label]="'Utgångsdatum'"
                [(ngModel)]="expiryDate"
                (input)="onExpiryDateInput($event)"
                (blur)="validateExpiryDate()"
                [ngClass]="{
                  'is-invalid':
                    !isExpiryDateValid && hasInteractedWithExpiryDate
                }"
              ></app-text-input>
              <div
                *ngIf="!isExpiryDateValid && hasInteractedWithExpiryDate"
                class="text-red-500 text-sm"
              >
                Utgångsdatum måste vara 4 siffror (MM/ÅÅ).
              </div>
            </div>
            <div class="flex flex-col w-1/2">
              <app-text-input
                [inputType]="'text'"
                [label]="'CVV'"
                [(ngModel)]="cvv"
                (input)="onCVVInput($event)"
                (blur)="validateCVV()"
                [ngClass]="{
                  'is-invalid': !isCVVValid && hasInteractedWithCVV
                }"
              ></app-text-input>
              <div
                *ngIf="!isCVVValid && hasInteractedWithCVV"
                class="text-red-500 text-sm"
              >
                CVV får endast innehålla siffror och måste vara tre siffror.
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="flex flex-row gap-4">
        <h2>Personliga uppgifter</h2>
        <div class="flex flex-row w-full gap-4">
          <div class="flex flex-col w-1/2">
            <app-text-input
              [inputType]="'text'"
              [label]="'Förnamn'"
              [(ngModel)]="firstName"
              (input)="onFirstNameInput($event)"
              (blur)="onFirstNameBlur()"
              [ngClass]="{
                'is-invalid': !isFirstNameValid && hasInteractedWithFirstName
              }"
            ></app-text-input>
            <div
              *ngIf="!isFirstNameValid && hasInteractedWithFirstName"
              class="text-red-500 text-sm"
            >
              Förnamn är obligatoriskt.
            </div>
          </div>
          <div class="flex flex-col w-1/2">
            <app-text-input
              [inputType]="'text'"
              [label]="'Efternamn'"
              [(ngModel)]="lastName"
              (input)="onLastNameInput($event)"
              (blur)="onLastNameBlur()"
              [ngClass]="{
                'is-invalid': !isLastNameValid && hasInteractedWithLastName
              }"
            ></app-text-input>
            <div
              *ngIf="!isLastNameValid && hasInteractedWithLastName"
              class="text-red-500 text-sm"
            >
              Efternamn är obligatoriskt.
            </div>
          </div>
        </div>

        <app-text-input
          [inputType]="'text'"
          [label]="'Gatuadress'"
          [(ngModel)]="streetAddress"
          (input)="onStreetAddressInput($event)"
          (blur)="onStreetAddressBlur()"
          [ngClass]="{
            'is-invalid':
              !isStreetAddressValid && hasInteractedWithStreetAddress
          }"
        ></app-text-input>
        <div
          *ngIf="!isStreetAddressValid && hasInteractedWithStreetAddress"
          class="text-red-500 text-sm"
        >
          Gatuadress är obligatorisk.
        </div>
        <div class="flex flex-row gap-4">
          <div class="flex flex-col w-1/3">
            <app-text-input
              [inputType]="'text'"
              [label]="'Postnummer'"
              [(ngModel)]="postalCode"
              (input)="onPostalCodeInput($event)"
              (blur)="validatePostalCode()"
              [ngClass]="{
                'is-invalid': !isPostalCodeValid && hasInteractedWithPostalCode
              }"
            ></app-text-input>
            <div
              *ngIf="!isPostalCodeValid && hasInteractedWithPostalCode"
              class="text-red-500 text-sm"
            >
              Postnumret får endast innehålla siffror och måste vara 5 siffror.
            </div>
          </div>
          <div class="flex flex-col w-2/3">
            <app-text-input
              [inputType]="'text'"
              [label]="'Stad'"
              [(ngModel)]="city"
              (blur)="validateCity()"
              [ngClass]="{
                'is-invalid': !isCityValid && hasInteractedWithCity
              }"
            ></app-text-input>
            <div
              *ngIf="!isCityValid && hasInteractedWithCity"
              class="text-red-500 text-sm"
            >
              Stad är obligatorisk.
            </div>
          </div>
        </div>
        <app-text-input
          [inputType]="'text'"
          [label]="'Land'"
          [(ngModel)]="country"
          (blur)="validateCountry()"
          [ngClass]="{
            'is-invalid': !isCountryValid && hasInteractedWithCountry
          }"
        ></app-text-input>
        <div
          *ngIf="!isCountryValid && hasInteractedWithCountry"
          class="text-red-500 text-sm"
        >
          Land är obligatoriskt.
        </div>
        <app-text-input
          [inputType]="'email'"
          [label]="'E-postadress'"
          [(ngModel)]="email"
          (blur)="validateEmail()"
          [ngClass]="{ 'is-invalid': !isEmailValid && hasInteractedWithEmail }"
        ></app-text-input>
        <div
          *ngIf="!isEmailValid && hasInteractedWithEmail"
          class="text-red-500 text-sm"
        >
          Ange en giltig e-postadress.
        </div>
      </section>
      <app-link linkType="secondary">Läs villkoren</app-link>
      <section class="flex gap-3">
        <h2>Krävs för din resa</h2>
        <div class="flex flex-row gap-4 max-w-xl">
          <div>
            <p class="font-semibold">Skicka ett meddelande till värden</p>
            <p>
              Du måste berätta lite mer om din resa för värden och varför hens
              boende passar dig innan du kan fortsätta.
            </p>
          </div>
          <app-button buttonType="secondary" class="text-nowrap"
            >Lägg till</app-button
          >
        </div>
        <div class="flex flex-row gap-4 max-w-xl">
          <div>
            <p class="font-semibold">Telefonnummer</p>
            <p>
              Lägg till och bekräfta ditt telefonnummer för att få
              reseuppdateringar.
            </p>
          </div>
          <app-button buttonType="secondary" class="text-nowrap"
            >Lägg till</app-button
          >
        </div>
      </section>
      <section>
        <h2>Avbokningspolicy</h2>
        <p>
          Avboka innan den 29 apr. för en delvis återbetalning. Därefter är
          denna bokning inte återbetalningsbar.
        </p>
        <app-link linkType="secondary">Läs mer</app-link>
      </section>
      <section>
        <h2>Grundregler</h2>
        Vi ber varje gäst att komma ihåg några enkla saker om vad som
        kännetecknar en bra gäst.
        <ul>
          <li>Följ husreglerna</li>
          <li>Behandla din värds boende som om det vore ditt eget</li>
        </ul>
      </section>
    </section>
    <aside class="border border-brand-mediumGray rounded-2xl w-1/2 p-6 h-fit">
      <h2 class="mt-0 mb-0">Summering</h2>
      {{ bookings.length }} {{ bookings.length === 1 ? "boende" : "boenden" }}
      <div class="h-[1px] bg-brand-shadowGray mb-8 mt-4"></div>

      <div *ngFor="let booking of bookings">
        <h3>{{ booking.listing_name || "Namn på boende" }}</h3>
        <div>{{ booking.total_price }} SEK</div>
      </div>
      <div class="h-[1px] bg-brand-shadowGray my-8"></div>

      <h3>Totalt</h3>
      <div class="font-semibold">{{ totalPrice }} SEK</div>
    </aside>
  </div>
  <div class="flex flex-row justify-between pt-8 items-center">
    <app-link linkType="secondary">Avbryt</app-link>
    <app-button buttonType="primary" (click)="onSubmit()"
      >Boka boende</app-button
    >
  </div>
</section>
